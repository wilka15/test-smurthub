<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SmartHub AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --accent: #7a5bff;
      --accent2: #00a6ff;
      --bg: linear-gradient(135deg, #120028, #001233);
      --panel: rgba(255,255,255,0.06);
      --text: #e9faff;
    }

    body {
      margin: 0;
      background: var(--bg);
      font-family: 'Orbitron', sans-serif;
      color: var(--text);
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    /* ---------- –í–´–ï–ó–ñ–ê–Æ–©–ï–ï –ú–ï–ù–Æ ---------- */

    .side-menu {
      width: 280px;
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(18px);
      border-left: 2px solid rgba(0,255,255,0.25);
      position: fixed;
      right: -280px;
      height: 100%;
      padding: 20px;
      transition: 0.4s ease;
      box-shadow: -4px 0 20px rgba(0,255,255,0.2);
    }

    .side-menu.open {
      right: 0;
    }

    .menu-btn {
      position: absolute;
      right: 20px;
      top: 20px;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none;
      font-weight: bold;
    }

    /* ------------ –ß–ê–¢ ------------- */

    .chat-wrapper {
      margin: auto;
      width: 90%;
      max-width: 900px;
    }

    .chat-container {
      background: var(--panel);
      backdrop-filter: blur(20px);
      padding: 20px;
      border-radius: 20px;
      border: 1px solid rgba(0,255,255,0.2);
      box-shadow: 0 0 30px rgba(0,255,255,0.15);
      height: 88vh;
      display: flex;
      flex-direction: column;
    }

    #chat {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
    }

    .msg {
      display: flex;
      margin-bottom: 14px;
      opacity: 0;
      transform: translateY(10px);
      animation: slideIn 0.4s forwards ease;
    }

    .msg.user { justify-content: flex-end; }
    .msg.ai { justify-content: flex-start; }

    .msg.user .bubble {
      animation: fromRight 0.35s ease;
    }
    .msg.ai .bubble {
      animation: fromLeft 0.35s ease;
    }

    @keyframes fromRight {
      0% { transform: translateX(40px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    @keyframes fromLeft {
      0% { transform: translateX(-40px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }

    .bubble {
      background: rgba(255,255,255,0.1);
      padding: 12px 16px;
      border-radius: 12px;
      max-width: 70%;
      backdrop-filter: blur(10px);
    }

    @keyframes slideIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ------- typing dots (–∫–∞–∫ –≤ Telegram) -------- */

    .typing-indicator {
      display: inline-flex;
      gap: 6px;
      padding: 10px 14px;
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
    }

    .dot {
      width: 8px;
      height: 8px;
      background: #fff;
      border-radius: 50%;
      opacity: 0.6;
      animation: bounce 1.4s infinite ease-in-out;
    }

    .dot:nth-child(1) { animation-delay: 0s; }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce {
      0%   { transform: translateY(0); opacity: 0.4; }
      30%  { transform: translateY(-5px); opacity: 1;   }
      60%  { transform: translateY(0); opacity: 0.4; }
      100% { transform: translateY(0); opacity: 0.4; }
    }

    .input-bar {
      display: flex;
      gap: 10px;
    }

    input {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      background: rgba(255,255,255,0.15);
      border: none;
      color: var(--text);
    }

    .btn {
      padding: 12px 16px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      cursor: pointer;
    }

    .clear-btn {
      background: rgba(255,255,255,0.2);
      margin-top: 6px;
      border-radius: 12px;
      padding: 10px;
      border: none;
      cursor: pointer;
      color: var(--text);
    }

    /* –ö–ù–û–ü–ö–ò –ú–ï–ù–Æ */
    .menu-section {
      margin-bottom: 20px;
    }
    .menu-section h3 { margin-bottom: 10px; }

    .toggle-btn {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      background: rgba(255,255,255,0.18);
      border: 1px solid rgba(0,255,255,0.2);
      margin-bottom: 10px;
      color: white;
      cursor: pointer;
    }

  </style>
</head>
<body>

<button class="menu-btn" id="menuToggle">‚â°</button>

<div class="side-menu" id="sideMenu">
  <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
  <div class="menu-section">
    <h3>–ì–æ–ª–æ—Å</h3>
    <button id="voiceToggle" class="toggle-btn">–û–∑–≤—É—á–∫–∞: –≤—ã–∫–ª</button>
    <button id="micToggle" class="toggle-btn">–ú–∏–∫—Ä–æ—Ñ–æ–Ω: –≤—ã–∫–ª</button>
  </div>

  <div class="menu-section">
    <h3>–§–æ—Ç–æ</h3>
    <input id="imgInput" type="file" accept="image/*" class="toggle-btn" />
  </div>
</div>

<div class="chat-wrapper">
  <div class="chat-container">
    <div id="chat"></div>

    <div class="input-bar">
      <input id="userInput" placeholder="–í–≤–µ–¥–∏—Ç–µ..." />
      <button class="btn" id="sendBtn">‚Üí</button>
    </div>

    <button class="clear-btn" id="clearBtn">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
  </div>
</div>


<script>
const chat = document.getElementById("chat");
const sideMenu = document.getElementById("sideMenu");

let speechEnabled = false;
let micEnabled = false;
let synth = window.speechSynthesis;

/* ---------- –ê–ù–ò–ú–ê–¶–ò–Ø typing ---------- */

function showTyping() {
  const wrap = document.createElement("div");
  wrap.className = "msg ai";
  wrap.id = "typingWrap";
  wrap.innerHTML = `
    <div class="bubble">
      <div class="typing-indicator">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>
    </div>
  `;
  chat.appendChild(wrap);
  chat.scrollTop = chat.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById("typingWrap");
  if (t) t.remove();
}

/* ---------- –ß–ê–¢ ---------- */

function addMessage(text, role) {
  let wrap = document.createElement("div");
  wrap.className = "msg " + role;

  let b = document.createElement("div");
  b.className = "bubble";
  b.textContent = text;

  wrap.appendChild(b);
  chat.appendChild(wrap);
  chat.scrollTop = chat.scrollHeight;

  if (role === "ai" && speechEnabled) {
    let utter = new SpeechSynthesisUtterance(text);
    synth.speak(utter);
  }
}

async function sendMessage() {
  const inp = document.getElementById("userInput");
  let text = inp.value.trim();
  if (!text) return;

  addMessage(text, "user");
  inp.value = "";

  showTyping();

  try {
    const res = await fetch("https://openai-proxy-3.onrender.com/v1/responses", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ model: "gpt-4o-mini", input: text })
    });

    const data = await res.json();
    removeTyping();

    let answer =
      data.output?.[0]?.content?.[0]?.text ||
      data.choices?.[0]?.message?.content ||
      "–û—à–∏–±–∫–∞";

    addMessage(answer, "ai");

  } catch {
    removeTyping();
    addMessage("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è", "ai");
  }
}

/* ------- –í–´–ï–ó–ñ–ê–Æ–©–ï–ï –ú–ï–ù–Æ ------- */

document.getElementById("menuToggle").onclick = () => {
  sideMenu.classList.toggle("open");
};

/* ------- –û–ß–ò–°–¢–ö–ê –ß–ê–¢–ê ------- */

document.getElementById("clearBtn").onclick = () => {
  chat.innerHTML = "";
};

/* ------- –û–¢–ü–†–ê–í–ö–ê ------- */

document.getElementById("sendBtn").onclick = sendMessage;
document.getElementById("userInput").addEventListener("keydown", e => {
  if (e.key === "Enter") sendMessage();
});

/* ------- –û–ó–í–£–ß–ö–ê ------- */

document.getElementById("voiceToggle").onclick = () => {
  speechEnabled = !speechEnabled;
  document.getElementById("voiceToggle").textContent =
    "–û–∑–≤—É—á–∫–∞: " + (speechEnabled ? "–≤–∫–ª" : "–≤—ã–∫–ª");
};

/* ------- –ú–ò–ö–†–û–§–û–ù (–≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥) ------- */

let recognition;

if ("webkitSpeechRecognition" in window) {
  recognition = new webkitSpeechRecognition();
  recognition.lang = "ru-RU";
  recognition.interimResults = false;

  recognition.onresult = e => {
    document.getElementById("userInput").value = e.results[0][0].transcript;
  };
}

document.getElementById("micToggle").onclick = () => {
  if (!recognition) return alert("–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");

  micEnabled = !micEnabled;
  document.getElementById("micToggle").textContent =
    "–ú–∏–∫—Ä–æ—Ñ–æ–Ω: " + (micEnabled ? "–≤–∫–ª" : "–≤—ã–∫–ª");

  if (micEnabled) recognition.start();
  else recognition.stop();
};

/* ------- –ó–ê–ì–†–£–ó–ö–ê –§–û–¢–û ------- */

document.getElementById("imgInput").onchange = async e => {
  const file = e.target.files[0];
  if (!file) return;

  addMessage("üì∑ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –æ—Ç–ø—Ä–∞–≤–ª—è—é –ò–ò...", "user");

  showTyping();

  // –µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Ä–µ–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ñ–æ—Ç–æ ‚Äî —Å–∫–∞–∂–∏, –≤—Å—Ç–∞–≤–ª—é OpenAI Vision
  setTimeout(() => {
    removeTyping();
    addMessage("–ò–ò –æ–±—Ä–∞–±–æ—Ç–∞–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ! (–∑–∞–≥–ª—É—à–∫–∞)", "ai");
  }, 1200);
};

</script>

</body>
</html>
