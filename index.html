<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI Chat</title>
<style>
:root {
  --bg-dark: #0b0f19;
  --text-dark: #eef2f5;
  --panel-dark: rgba(255,255,255,0.05);
  --bg-light: #ffffff;
  --text-light: #222222;
  --panel-light: rgba(0,0,0,0.07);
  --accent: #00d4ff;
}

body {
  margin: 0;
  font-family: "Inter", sans-serif;
  background: var(--bg-dark);
  color: var(--text-dark);
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s;
}
body.light {
  background: var(--bg-light);
  color: var(--text-light);
}

.container {
  width: 95%;
  max-width: 900px;
  display: flex;
  gap: 20px;
}

.chat {
  flex: 2;
  background: var(--panel-dark);
  border-radius: 12px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  height: 80vh;
  transition: 0.3s;
}
body.light .chat { background: var(--panel-light); }

.header {
  font-size: 24px;
  color: var(--accent);
  text-align: center;
  margin-bottom: 10px;
}

.window {
  flex: 1;
  overflow-y: auto;
  padding-right: 10px;
}

.msg {
  margin-bottom: 14px;
  display: flex;
  gap: 10px;
}
.msg.user { justify-content: flex-end; }

.bubble {
  max-width: 70%;
  padding: 10px 14px;
  border-radius: 12px;
  background: var(--panel-dark);
  animation: fade 0.3s forwards;
}
body.light .bubble { background: var(--panel-light); }
.msg.user .bubble { background: var(--accent); color: black; }

@keyframes fade {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

.typing {
  display: flex;
  gap: 4px;
}
.typing span {
  width: 6px;
  height: 6px;
  background: var(--accent);
  border-radius: 50%;
  animation: bounce 1s infinite;
}
.typing span:nth-child(2) { animation-delay: .2s; }
.typing span:nth-child(3) { animation-delay: .4s; }
@keyframes bounce {
  0%, 80% { transform: translateY(0); opacity: .3; }
  40% { transform: translateY(-6px); opacity: 1; }
}

.input-area {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

input[type=text] {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: none;
  outline: none;
  background: rgba(0,0,0,0.2);
  color: inherit;
}
body.light input[type=text] { background: rgba(0,0,0,0.1); }

.btn {
  cursor: pointer;
  border: none;
  border-radius: 10px;
  font-size: 18px;
  padding: 0 14px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.btn.send {
  background: var(--accent);
  color: #002;
  width: 48px;
}

.btn.clear {
  background: linear-gradient(135deg, #ff3b3b, #ff6b6b);
  color: white;
  padding: 10px 18px;
  font-weight: 600;
  box-shadow: 0 4px 10px rgba(255,0,0,0.3);
  transition: 0.25s;
}
.btn.clear:hover {
  background: linear-gradient(135deg, #ff1f1f, #ff5e5e);
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(255,0,0,0.4);
}

.settings {
  flex: 1;
  background: var(--panel-dark);
  border-radius: 12px;
  padding: 20px;
  transition: 0.3s;
}
body.light .settings { background: var(--panel-light); }

.photo-input { display: none; }

</style>
</head>
<body>
<div class="container">
  <div class="chat">
    <div class="header">AI Chat</div>
    <div id="chatWindow" class="window"></div>

    <div class="input-area">
      <input id="textInput" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
      <button class="btn send" id="sendBtn">‚û§</button>
      <button class="btn" id="photoBtn">üì∑</button>
      <input type="file" id="photoInput" class="photo-input" accept="image/*" />
    </div>
  </div>

  <div class="settings">
    <h3 style="color:var(--accent);margin-top:0;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
    <label>
      <input type="checkbox" id="themeSwitch" /> –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
    </label>

    <br><br>
    <button class="btn clear" id="clearBtn">üóë –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç</button>
  </div>
</div>

<script>
const chat = document.getElementById("chatWindow");
const textInput = document.getElementById("textInput");
const themeSwitch = document.getElementById("themeSwitch");
const photoInput = document.getElementById("photoInput");

const API_TEXT = "https://openai-proxy-3.onrender.com/v1/responses";

function addMessage(text, role) {
  const div = document.createElement("div");
  div.className = "msg " + role;
  const bubble = document.createElement("div");
  bubble.className = "bubble";
  bubble.textContent = text;
  div.appendChild(bubble);
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function addTyping() {
  const div = document.createElement("div");
  div.className = "msg ai";
  div.id = "typing";
  div.innerHTML = `<div class="bubble"><div class="typing"><span></span><span></span><span></span></div></div>`;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}
function removeTyping() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}

async function sendText() {
  const text = textInput.value.trim();
  if (!text) return;

  addMessage(text, "user");
  textInput.value = "";

  addTyping();

  const res = await fetch(API_TEXT, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ model: "gpt-4o-mini", input: text })
  });
  const data = await res.json();

  removeTyping();

  let answer =
    data.choices?.[0]?.message?.content ||
    data.output?.[0]?.content?.[0]?.text ||
    "–û—à–∏–±–∫–∞ –æ—Ç–≤–µ—Ç–∞ API";

  addMessage(answer, "ai");
}

document.getElementById("sendBtn").onclick = sendText;
textInput.addEventListener("keydown", e => {
  if (e.key === "Enter") sendText();
});

// ---------- –°–º–µ–Ω–∞ —Ç–µ–º—ã ----------
themeSwitch.onchange = () => {
  document.body.classList.toggle("light", themeSwitch.checked);
};

// ---------- –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç ----------
document.getElementById("clearBtn").onclick = () => {
  chat.innerHTML = "";
};

// ---------- –§–æ—Ç–æ ----------
document.getElementById("photoBtn").onclick = () => photoInput.click();
photoInput.onchange = () => {
  const file = photoInput.files[0];
  if (!file) return;

  addMessage("–§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)", "user");
};
</script>
</body>
</html>
