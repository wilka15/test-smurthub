<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neon AI Chat ‚Äî –ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#7a5bff; --accent2:#00a6ff; --bg-a:#090014; --panel:rgba(255,255,255,0.06); --text:#e9faff;
    }
    *{box-sizing:border-box}
    body{margin:0;height:100vh;background:linear-gradient(135deg,#120028,#001233);font-family:'Orbitron',sans-serif;color:var(--text);display:flex;align-items:center;justify-content:center}
    .layout{width:94%;max-width:1100px;height:86vh;display:grid;grid-template-columns:1fr 260px;gap:24px}

    /* SETTINGS RIGHT */
    .settings{
      background:var(--panel);backdrop-filter:blur(12px);padding:18px;border-radius:16px;
      border:1px solid rgba(0,255,255,0.08);box-shadow:0 8px 30px rgba(0,0,0,0.35);
      display:flex;flex-direction:column;gap:14px;align-items:stretch;
    }
    .settings h3{margin:0;color:var(--accent)}
    .control-row{display:flex;gap:10px;align-items:center}
    .control-label{font-size:13px;opacity:0.9}
    .big-btn{
      padding:10px;border-radius:10px;border:none;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:#000;font-weight:700;cursor:pointer;
    }
    .ghost-btn{
      padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);
      background:transparent;color:var(--text);cursor:pointer;
    }

    /* CHAT */
    .chat-panel{
      background:var(--panel);backdrop-filter:blur(18px);padding:18px;border-radius:16px;
      border:1px solid rgba(0,255,255,0.06);display:flex;flex-direction:column;height:100%;
    }
    #chat{flex:1;overflow:auto;padding:6px 4px}
    .msg{display:flex;margin:10px 6px}
    .msg.user{justify-content:flex-end}
    .bubble{
      max-width:70%;padding:12px 14px;border-radius:12px;
      background:rgba(255,255,255,0.06);backdrop-filter:blur(6px)
    }
    .bubble.ai{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02))}

    .input-bar{
      display:flex;gap:10px;margin-top:12px;
    }
    .input-bar input{
      flex:1;padding:12px;border-radius:10px;border:none;
      background:rgba(255,255,255,0.09);color:var(--text);
    }
    .input-bar button{
      padding:10px 14px;border-radius:10px;border:none;cursor:pointer;
      font-weight:700;min-width:110px;
    }

    /* neon blobs */
    .neon-blobs{position:fixed;inset:0;z-index:-1;pointer-events:none}
    .neon-blobs .blob{position:absolute;width:520px;height:520px;border-radius:50%;filter:blur(80px);mix-blend-mode:screen}
    .blob.a{left:-120px;top:-80px;background:radial-gradient(circle,#7a5bff,transparent 40%)}
    .blob.b{right:-140px;bottom:-40px;background:radial-gradient(circle,#00a6ff,transparent 40%)}
    .blob.c{left:40%;top:60%;background:radial-gradient(circle,#b0ff7a,transparent 35%)}

    @media(max-width:880px){
      .layout{grid-template-columns:1fr}
      .settings{order:2}
      .chat-panel{order:1;height:72vh}
    }
  </style>
</head>
<body>

<div class="neon-blobs">
  <div class="blob a"></div>
  <div class="blob b"></div>
  <div class="blob c"></div>
</div>

<div class="layout">

  <!-- CHAT LEFT -->
  <section class="chat-panel">
    <div id="chat"></div>

    <!-- INPUT + BUTTONS IN ONE LINE -->
    <div class="input-bar">
      <input id="userInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
      <button id="sendBtn" class="big-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      <button id="clearBtn" class="ghost-btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
    </div>
  </section>

  <!-- SETTINGS RIGHT -->
  <aside class="settings">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

    <div class="control-row">
      <div class="control-label">–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥</div>
      <button id="micToggle" class="big-btn">–í–∫–ª üé§</button>
    </div>

    <div class="control-row">
      <div class="control-label">–û–∑–≤—É—á–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤</div>
      <button id="ttsToggle" class="ghost-btn">–û—Ç–∫–ª—é—á–µ–Ω–æ üîà</button>
    </div>

    <div class="control-row">
      <div class="control-label">–°—Ç–æ–ø –æ–∑–≤—É—á–∫–∏</div>
      <button id="stopSpeak" class="ghost-btn">üõë –°—Ç–æ–ø</button>
    </div>

    <div class="control-row">
      <div class="control-label">–§–æ—Ç–æ</div>
      <button id="photoSend" class="big-btn">üì∑ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
      <input id="photoFile" type="file" accept="image/*" style="display:none">
    </div>

    <div style="margin-top:auto;font-size:12px;opacity:0.9">–í–µ—Ä—Å–∏—è: 1.1 ‚Äî –ù–µ–æ–Ω UI</div>
  </aside>

</div>

<script>
/* Elements */
const chat = document.getElementById('chat');
const sendBtn = document.getElementById('sendBtn');
const userInput = document.getElementById('userInput');
const clearBtn = document.getElementById('clearBtn');
const micToggle = document.getElementById('micToggle');
const ttsToggle = document.getElementById('ttsToggle');
const stopSpeak = document.getElementById('stopSpeak');
const photoSend = document.getElementById('photoSend');
const photoFile = document.getElementById('photoFile');

let lastAIAnswer = '';
let ttsEnabled = false;
let currentUtterance = null;
let micActive = false;
let rec = null;

/* Add message */
function addMessage(text, role){
  const w = document.createElement('div'); w.className = 'msg ' + role;
  const b = document.createElement('div'); b.className = 'bubble ' + (role === 'ai' ? 'ai' : '');
  b.textContent = text; w.appendChild(b); chat.appendChild(w); chat.scrollTop = chat.scrollHeight;
}

/* Send text */
async function sendMessage(textOverride){
  const txt = textOverride || userInput.value.trim();
  if(!txt) return;
  addMessage(txt,'user');
  userInput.value='';

  const typing = document.createElement('div');
  typing.className='msg ai';
  typing.innerHTML='<div class="bubble">...</div>';
  chat.appendChild(typing);

  try{
    const res = await fetch('https://openai-proxy-3.onrender.com/v1/responses',{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ model:'gpt-4o-mini', input:txt })
    });
    const data = await res.json();
    typing.remove();

    const ans = data.output?.[0]?.content?.[0]?.text || '–û—à–∏–±–∫–∞: –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞';
    lastAIAnswer = ans;
    addMessage(ans,'ai');

    if(ttsEnabled) speakText(ans);

  } catch(e){
    typing.remove();
    addMessage('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞','ai');
  }
}

sendBtn.onclick=()=>sendMessage();
userInput.addEventListener('keydown',e=>{ if(e.key==='Enter') sendMessage(); });
clearBtn.onclick=()=>chat.innerHTML='';

/* TTS */
function speakText(text){
  if(currentUtterance){ speechSynthesis.cancel(); }
  currentUtterance=new SpeechSynthesisUtterance(text);
  currentUtterance.lang='ru-RU';
  speechSynthesis.speak(currentUtterance);
}
ttsToggle.onclick=()=>{
  ttsEnabled=!ttsEnabled;
  ttsToggle.textContent = ttsEnabled ? '–í–∫–ª—é—á–µ–Ω–æ üîä' : '–û—Ç–∫–ª—é—á–µ–Ω–æ üîà';
};
stopSpeak.onclick=()=> speechSynthesis.cancel();

/* Mic */
micToggle.onclick=()=>{
  if(!('webkitSpeechRecognition'in window)||!window.webkitSpeechRecognition){
    alert("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥"); return;
  }
  if(!rec){
    rec=new webkitSpeechRecognition();
    rec.lang='ru-RU'; rec.interimResults=false;
    rec.onresult=e=>sendMessage(e.results[0][0].transcript);
    rec.onend=()=>{ if(micActive) rec.start(); };
  }
  if(!micActive){
    micActive=true; rec.start();
    micToggle.textContent="–í—ã–∫–ª—é—á–∏—Ç—å üé§";
  } else {
    micActive=false; rec.stop();
    micToggle.textContent="–í–∫–ª üé§";
  }
};

/* Photo */
photoSend.onclick=()=>photoFile.click();
photoFile.onchange=async function(){
  const file=this.files[0]; if(!file) return;
  addMessage("üì∑ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ","user");

  const reader=new FileReader();
  reader.onload=async()=>{
    const base64=reader.result.split(',')[1];

    const typing=document.createElement('div');
    typing.className='msg ai';
    typing.innerHTML='<div class="bubble">...</div>';
    chat.appendChild(typing);

    try{
      const res=await fetch('https://openai-proxy-3.onrender.com/v1/responses',{
        method:'POST',headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          model:'gpt-4o-mini',
          input:[{ type:'input_image', image_base64:base64, instruction:'–û–ø–∏—à–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }]
        })
      });
      const data=await res.json();
      typing.remove();
      const ans=data.output?.[0]?.content?.[0]?.text || "–û—à–∏–±–∫–∞: –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞";
      addMessage(ans,'ai');
      if(ttsEnabled) speakText(ans);
    }catch(e){
      typing.remove();
      addMessage("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞","ai");
    }
  };
  reader.readAsDataURL(file);
};

</script>
</body>
</html>
