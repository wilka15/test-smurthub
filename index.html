<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AI Chat</title>
<style>
    body {
        margin: 0;
        font-family: Arial;
        background: #0a0f24;
        color: white;
        overflow: hidden;
    }

    /* ------------ ЧАТ ------------ */
    #chat {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 60px;
        right: 0;
        padding: 20px;
        overflow-y: auto;
    }

    .msg {
        max-width: 60%;
        padding: 12px 16px;
        margin: 10px 0;
        border-radius: 14px;
        opacity: 0;
        animation: fadeSlide .35s forwards;
    }

    .me {
        background: #3c59ff;
        margin-left: auto;
        animation-name: slideRight;
    }

    .ai {
        background: #1e243a;
        margin-right: auto;
        animation-name: slideLeft;
    }

    @keyframes slideRight {
        from { transform: translateX(40px); opacity: 0; }
        to   { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideLeft {
        from { transform: translateX(-40px); opacity: 0; }
        to   { transform: translateX(0); opacity: 1; }
    }

    /* ------------ ПОЛЕ ВВОДА ------------ */
    #bottom {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        height: 60px;
        background: #10172f;
        display: flex;
        gap: 10px;
        padding: 10px;
    }

    #input {
        flex: 1;
        border-radius: 10px;
        border: none;
        padding: 12px;
        outline: none;
    }

    /* ------------ МЕНЮ (slide-menu) ------------ */
    #menu {
        position: fixed;
        top: 0;
        right: -280px;
        width: 280px;
        height: 100%;
        background: #151b33;
        transition: 0.35s;
        padding: 20px;
    }

    #menu.open {
        right: 0;
    }

    #menuBtn {
        position: fixed;
        right: 20px;
        top: 20px;
        background: #3c59ff;
        border: none;
        padding: 10px 16px;
        border-radius: 10px;
        color: white;
        cursor: pointer;
    }

    /* ------------ typing indicator ------------ */
    .dots {
        width: 35px;
        display: flex;
        justify-content: space-between;
        margin-left: 5px;
    }

    .dot {
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
        animation: bounce 0.9s infinite;
    }

    .dot:nth-child(2) { animation-delay: 0.15s; }
    .dot:nth-child(3) { animation-delay: 0.3s; }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-6px); }
    }
</style>
</head>
<body>

<button id="menuBtn">Меню</button>

<div id="menu">
    <h3>Настройки</h3>

    <h4>Фото</h4>
    <input type="file" id="photoInput">
    <br><br>

    <h4>Озвучка ответа</h4>
    <label><input type="checkbox" id="voiceToggle"> Включить озвучку</label>
    <br><br>

    <h4>Сохранение диалога</h4>
    <button id="saveChat">Сохранить .txt</button>
    <br><br>
    <button id="clearChat">Очистить историю</button>
</div>

<div id="chat"></div>

<div id="bottom">
    <input id="input" placeholder="Напишите сообщение...">
    <button onclick="send()">➤</button>
</div>

<script>
let chat = document.getElementById("chat");
let input = document.getElementById("input");
let menu = document.getElementById("menu");
let dotsElement = null;

/* ------------ Slide menu ------------ */
document.getElementById("menuBtn").onclick = () => {
    menu.classList.toggle("open");
};

/* ------------ Voice ON/OFF ------------ */
let speakEnabled = false;
document.getElementById("voiceToggle").onchange = e => {
    speakEnabled = e.target.checked;
};

/* ------------ Save Chat ------------ */
document.getElementById("saveChat").onclick = () => {
    let text = chat.innerText;
    let blob = new Blob([text], { type: "text/plain" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "chat_history.txt";
    a.click();
};

/* ------------ Clear Chat ------------ */
document.getElementById("clearChat").onclick = () => {
    chat.innerHTML = "";
};

/* ------------ Create message bubble ------------ */
function addMessage(text, who="me") {
    let div = document.createElement("div");
    div.className = "msg " + who;
    div.innerHTML = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

/* ------------ Add typing indicator ------------ */
function showTyping() {
    dotsElement = document.createElement("div");
    dotsElement.className = "msg ai";
    dotsElement.innerHTML = `
        <div class="dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>`;
    chat.appendChild(dotsElement);
    chat.scrollTop = chat.scrollHeight;
}

function removeTyping() {
    if (dotsElement) dotsElement.remove();
}

/* ------------ Send message ------------ */
async function send() {
    let text = input.value.trim();
    input.value = "";

    addMessage(text, "me");

    showTyping();

    // Fake AI reply to demonstrate UI
    setTimeout(() => {
        removeTyping();
        addMessage("Ответ ИИ на: " + text, "ai");

        if (speakEnabled) {
            let utter = new SpeechSynthesisUtterance("Ответ ИИ на " + text);
            speechSynthesis.speak(utter);
        }
    }, 900);
}

/* ------------ Photo upload ------------ */
document.getElementById("photoInput").onchange = function () {
    let file = this.files[0];
    if (!file) return;

    let reader = new FileReader();
    reader.onload = () => {
        let base64 = reader.result;

        addMessage(`<img src="${base64}" style="max-width:200px;border-radius:10px;">`, "me");

        showTyping();

        setTimeout(() => {
            removeTyping();
            addMessage("Фото обработано ИИ (демо-режим)", "ai");
        }, 1100);
    };
    reader.readAsDataURL(file);
};
</script>

</body>
</html>
