<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>AI Chat</title>
<style>
    body {
        margin: 0;
        font-family: Arial;
        background: #0a0f24;
        color: white;
        overflow: hidden;
    }

    /* ------------ –ß–ê–¢ ------------ */
    #chat {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 60px;
        right: 0;
        padding: 20px;
        overflow-y: auto;
    }

    .msg {
        max-width: 60%;
        padding: 12px 16px;
        margin: 10px 0;
        border-radius: 14px;
        opacity: 0;
        animation: fadeSlide .35s forwards;
    }

    .me {
        background: #3c59ff;
        margin-left: auto;
        animation-name: slideRight;
    }

    .ai {
        background: #1e243a;
        margin-right: auto;
        animation-name: slideLeft;
    }

    @keyframes slideRight {
        from { transform: translateX(40px); opacity: 0; }
        to   { transform: translateX(0); opacity: 1; }
    }

    @keyframes slideLeft {
        from { transform: translateX(-40px); opacity: 0; }
        to   { transform: translateX(0); opacity: 1; }
    }

    /* ------------ –ü–û–õ–ï –í–í–û–î–ê ------------ */
    #bottom {
        position: fixed;
        left: 0;
        right: 0;
        bottom: 0;
        height: 60px;
        background: #10172f;
        display: flex;
        gap: 10px;
        padding: 10px;
    }

    #input {
        flex: 1;
        border-radius: 10px;
        border: none;
        padding: 12px;
        outline: none;
    }

    /* ------------ –ú–ï–ù–Æ (slide-menu) ------------ */
    #menu {
        position: fixed;
        top: 0;
        right: -280px;
        width: 280px;
        height: 100%;
        background: #151b33;
        transition: 0.35s;
        padding: 20px;
        overflow-y: auto;
    }

    #menu.open {
        right: 0;
    }

    #menuBtn {
        position: fixed;
        right: 20px;
        top: 20px;
        background: #3c59ff;
        border: none;
        padding: 10px 16px;
        border-radius: 10px;
        color: white;
        cursor: pointer;
        z-index: 20;
    }

    /* ------------ typing indicator ------------ */
    .dots {
        width: 35px;
        display: flex;
        justify-content: space-between;
        margin-left: 5px;
    }

    .dot {
        width: 6px;
        height: 6px;
        background: white;
        border-radius: 50%;
        animation: bounce 0.9s infinite;
    }

    .dot:nth-child(2) { animation-delay: 0.15s; }
    .dot:nth-child(3) { animation-delay: 0.3s; }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-6px); }
    }

    /* ===========================================
       üì± –ê–î–ê–ü–¢–ò–í –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–´–• (–ò–ù–¢–ï–†–§–ï–ô–° –ù–ï –ú–ï–ù–Ø–Æ!)
       =========================================== */
    @media (max-width: 768px) {
        #chat {
            padding: 12px;
        }
        .msg {
            max-width: 80%;
            font-size: 14px;
            padding: 10px 12px;
            margin: 8px 0;
        }
        #bottom {
            height: 55px;
            padding: 8px;
            gap: 6px;
        }
        #input {
            padding: 10px;
            font-size: 14px;
        }
        #menu {
            width: 240px;
            padding: 16px;
        }
        #menuBtn {
            right: 12px;
            top: 12px;
            padding: 8px 14px;
            font-size: 14px;
        }
        img {
            max-width: 160px !important;
        }
    }

    @media (max-width: 480px) {
        #menu {
            width: 210px;
        }
        .msg {
            max-width: 90%;
            font-size: 13px;
            padding: 9px 11px;
        }
        #input {
            font-size: 13px;
            padding: 9px;
        }
        #bottom button {
            padding: 0 12px;
            font-size: 16px;
        }
        #menuBtn {
            padding: 7px 12px;
        }
    }
</style>
</head>
<body>

<button id="menuBtn">–ú–µ–Ω—é</button>

<div id="menu">
    <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>

    <h4>–§–æ—Ç–æ</h4>
    <input type="file" id="photoInput">
    <br><br>

    <h4>–û–∑–≤—É—á–∫–∞ –æ—Ç–≤–µ—Ç–∞</h4>
    <label><input type="checkbox" id="voiceToggle"> –í–∫–ª—é—á–∏—Ç—å –æ–∑–≤—É—á–∫—É</label>
    <br><br>

    <h4>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞</h4>
    <button id="saveChat">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å .txt</button>
    <br><br>
    <button id="clearChat">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
</div>

<div id="chat"></div>

<div id="bottom">
    <input id="input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
    <button onclick="send()">‚û§</button>
</div>

<script>
let chat = document.getElementById("chat");
let input = document.getElementById("input");
let menu = document.getElementById("menu");
let dotsElement = null;

/* ------------ Slide menu ------------ */
document.getElementById("menuBtn").onclick = () => {
    menu.classList.toggle("open");
};

/* ------------ Voice ON/OFF ------------ */
let speakEnabled = false;
document.getElementById("voiceToggle").onchange = e => {
    speakEnabled = e.target.checked;
};

/* ------------ Save Chat ------------ */
document.getElementById("saveChat").onclick = () => {
    let text = chat.innerText;
    let blob = new Blob([text], { type: "text/plain" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "chat_history.txt";
    a.click();
};

/* ------------ Clear Chat ------------ */
document.getElementById("clearChat").onclick = () => {
    chat.innerHTML = "";
};

/* ------------ Create message bubble ------------ */
function addMessage(text, who="me") {
    let div = document.createElement("div");
    div.className = "msg " + who;
    div.innerHTML = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

/* ------------ Add typing indicator ------------ */
function showTyping() {
    dotsElement = document.createElement("div");
    dotsElement.className = "msg ai";
    dotsElement.innerHTML = `
        <div class="dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>`;
    chat.appendChild(dotsElement);
    chat.scrollTop = chat.scrollHeight;
}

function removeTyping() {
    if (dotsElement) dotsElement.remove();
}

/* ------------ Send message ------------ */
async function send() {
    let text = input.value.trim();
    input.value = "";

    addMessage(text, "me");
    showTyping();

    setTimeout(() => {
        removeTyping();
        addMessage("–û—Ç–≤–µ—Ç –ò–ò –Ω–∞: " + text, "ai");

        if (speakEnabled) {
            let utter = new SpeechSynthesisUtterance("–û—Ç–≤–µ—Ç –ò–ò –Ω–∞ " + text);
            speechSynthesis.speak(utter);
        }
    }, 900);
}

/* ------------ Photo upload ------------ */
document.getElementById("photoInput").onchange = function () {
    let file = this.files[0];
    if (!file) return;

    let reader = new FileReader();
    reader.onload = () => {
        let base64 = reader.result;

        addMessage(`<img src="${base64}" style="max-width:200px;border-radius:10px;">`, "me");

        showTyping();

        setTimeout(() => {
            removeTyping();
            addMessage("–§–æ—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –ò–ò (–¥–µ–º–æ-—Ä–µ–∂–∏–º)", "ai");
        }, 1100);
    };
    reader.readAsDataURL(file);
};
</script>

</body>
</html>
