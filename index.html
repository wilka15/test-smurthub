<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Neon AI Chat ‚Äî –° –≤—ã–µ–∑–∂–∞—é—â–∏–º –º–µ–Ω—é</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{ --accent:#7a5bff; --accent2:#00a6ff; --bg-a:#090014; --panel:rgba(255,255,255,0.06); --text:#e9faff; }
    *{box-sizing:border-box}
    body{margin:0;height:100vh;background:linear-gradient(135deg,#120028,#001233);font-family:'Orbitron',sans-serif;color:var(--text);display:flex;align-items:center;justify-content:center}

    /* layout */
    .wrap{width:94%;max-width:1200px;height:88vh;position:relative}
    .main{height:100%;display:flex;gap:24px}

    /* chat panel */
    .chat-panel{flex:1; background:var(--panel);backdrop-filter:blur(18px);padding:18px;border-radius:16px;border:1px solid rgba(0,255,255,0.06);display:flex;flex-direction:column}
    #chat{flex:1;overflow:auto;padding:6px 4px}
    .msg{display:flex;margin:10px 6px}
    .msg.user{justify-content:flex-end; animation: slideInRight .28s cubic-bezier(.22,.9,.24,1);} 
    .msg.ai{animation: slideInLeft .28s cubic-bezier(.22,.9,.24,1);} 
    .bubble{max-width:70%;padding:12px 14px;border-radius:12px;background:rgba(255,255,255,0.06);backdrop-filter:blur(6px)}
    .bubble.ai{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02))}

    .input-bar{display:flex;gap:10px;margin-top:12px}
    .input-bar input{flex:1;padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.09);color:var(--text)}
    .input-bar button{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#000;font-weight:700;min-width:110px}

    /* neon blobs */
    .neon-blobs{position:fixed;inset:0;z-index:-2;pointer-events:none}
    .neon-blobs .blob{position:absolute;width:520px;height:520px;border-radius:50%;filter:blur(80px);mix-blend-mode:screen}
    .blob.a{left:-120px;top:-80px;background:radial-gradient(circle,#7a5bff,transparent 40%)}
    .blob.b{right:-140px;bottom:-40px;background:radial-gradient(circle,#00a6ff,transparent 40%)}
    .blob.c{left:40%;top:60%;background:radial-gradient(circle,#b0ff7a,transparent 35%)}

    /* slide menu (right) */
    .slide-menu{position:fixed;right:0;top:0;height:100vh;width:0;background:linear-gradient(180deg, rgba(10,4,20,0.95), rgba(5,2,10,0.95));box-shadow:-40px 0 80px rgba(0,0,0,0.6);overflow:hidden;transition:width .4s cubic-bezier(.2,.9,.2,1);z-index:40;border-left:1px solid rgba(255,255,255,0.03)}
    .slide-menu.open{width:340px}
    .menu-inner{padding:22px;color:var(--text)}
    .menu-header{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .menu-header h3{margin:0;color:var(--accent)}
    .menu-section{margin-top:18px}
    .menu-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.02)}
    .menu-row .label{opacity:0.9}
    .menu-row button{padding:8px 10px;border-radius:8px;border:none;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#000;font-weight:600}

    /* toggle button top-right */
    .menu-toggle{position:fixed;right:16px;top:16px;z-index:60;padding:10px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#000;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,0.4)}

    /* typing indicator ‚Äî 3 jumping dots (Telegram-like) */
    .typing-indicator { display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:10px; background: rgba(255,255,255,0.06); }
    .typing-indicator .dot { width:8px; height:8px; background:#fff; border-radius:50%; opacity:0.6; transform: translateY(0); animation: bounce 1.2s infinite ease-in-out; box-shadow: 0 0 8px rgba(122,91,255,0.3); }
    .typing-indicator .dot:nth-child(1){ animation-delay: 0s; }
    .typing-indicator .dot:nth-child(2){ animation-delay: 0.12s; }
    .typing-indicator .dot:nth-child(3){ animation-delay: 0.24s; }

    @keyframes bounce {
      0% { transform: translateY(0); opacity:0.4; }
      30% { transform: translateY(-6px); opacity:1; }
      60% { transform: translateY(0); opacity:0.4; }
      100% { transform: translateY(0); opacity:0.4; }
    }

    /* animations */
    @keyframes slideInRight { from { transform: translateX(40px); opacity: 0; } to { transform: translateX(0); opacity:1; } }
    @keyframes slideInLeft { from { transform: translateX(-40px); opacity: 0; } to { transform: translateX(0); opacity:1; } }

    /* responsive */
    @media (max-width:880px){ .slide-menu.open{width:100%} .menu-toggle{right:12px} }
  </style>
</head>
<body>

  <button class="menu-toggle" id="menuToggle">‚ò∞</button>

  <div class="neon-blobs">
    <div class="blob a"></div>
    <div class="blob b"></div>
    <div class="blob c"></div>
  </div>

  <div class="wrap">
    <div class="main">
      <div class="chat-panel">
        <div id="chat"></div>
        <div class="input-bar">
          <input id="userInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ Enter –∏–ª–∏ –∫–Ω–æ–ø–∫—É" />
          <button id="sendBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          <button id="clearBtn" style="background:rgba(255,255,255,0.08);color:var(--text);font-weight:600">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
      <!-- right side reserved for spacing (menu overlays) -->
      <div style="width:0"></div>
    </div>
  </div>

  <!-- Slide Menu -->
  <aside class="slide-menu" id="slideMenu">
    <div class="menu-inner">
      <div class="menu-header">
        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
        <button id="menuClose" style="background:transparent;border:none;color:var(--text);font-size:18px">‚úï</button>
      </div>

      <div class="menu-section">
        <div class="menu-row">
          <div class="label">–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥</div>
          <button id="micToggle">–í–∫–ª üé§</button>
        </div>

        <div class="menu-row">
          <div class="label">–û–∑–≤—É—á–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤</div>
          <button id="ttsToggle">–û—Ç–∫–ª—é—á–µ–Ω–æ üîà</button>
        </div>

        <div class="menu-row">
          <div class="label">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∑–≤—É—á–∫—É</div>
          <button id="stopSpeak">üõë –°—Ç–æ–ø</button>
        </div>

        <div class="menu-row">
          <div class="label">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
          <button id="photoSend">üì∑</button>
          <input id="photoFile" type="file" accept="image/*" style="display:none">
        </div>
      </div>

      <div style="margin-top:20px;font-size:13px;opacity:0.9">–í–µ—Ä—Å–∏—è: 1.2 ‚Äî Slide menu</div>
    </div>
  </aside>

<script>
// elements
const menuToggle = document.getElementById('menuToggle');
const slideMenu = document.getElementById('slideMenu');
const menuClose = document.getElementById('menuClose');
const micToggle = document.getElementById('micToggle');
const ttsToggle = document.getElementById('ttsToggle');
const stopSpeak = document.getElementById('stopSpeak');
const photoSend = document.getElementById('photoSend');
const photoFile = document.getElementById('photoFile');

const chat = document.getElementById('chat');
const sendBtn = document.getElementById('sendBtn');
const userInput = document.getElementById('userInput');
const clearBtn = document.getElementById('clearBtn');

let ttsEnabled = false;
let currentUtterance = null;
let rec = null;
let micActive = false;

menuToggle.onclick = ()=> slideMenu.classList.toggle('open');
menuClose.onclick = ()=> slideMenu.classList.remove('open');

function addMessage(text, role){
  const w = document.createElement('div'); w.className = 'msg ' + role;
  const b = document.createElement('div'); b.className = 'bubble ' + (role === 'ai' ? 'ai' : '');
  b.textContent = text; w.appendChild(b); chat.appendChild(w); chat.scrollTop = chat.scrollHeight;
}

/* create typing bubble with 3 jumping dots */
function createTypingBubble(){
  const typing = document.createElement('div');
  typing.className = 'msg ai';
  typing.id = 'typingBubble';
  typing.innerHTML = `
    <div class="bubble ai">
      <div class="typing-indicator">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
    </div>
  `;
  return typing;
}

async function sendMessage(textOverride){
  const txt = textOverride || userInput.value.trim(); if(!txt) return; addMessage(txt,'user'); userInput.value='';
  const typing = createTypingBubble();
  chat.appendChild(typing);
  chat.scrollTop = chat.scrollHeight;

  try{
    const res = await fetch('https://openai-proxy-3.onrender.com/v1/responses',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ model:'gpt-4o-mini', input:txt }) });
    const data = await res.json();
    // remove typing
    const t = document.getElementById('typingBubble'); if(t) t.remove();

    const ans = data.output?.[0]?.content?.[0]?.text || data.choices?.[0]?.message?.content || '–û—à–∏–±–∫–∞: –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞';
    addMessage(ans,'ai');
    if(ttsEnabled) speakText(ans);
  }catch(e){ const t = document.getElementById('typingBubble'); if(t) t.remove(); addMessage('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞','ai'); console.error(e); }
}

sendBtn.onclick = ()=> sendMessage();
userInput.addEventListener('keydown', e=>{ if(e.key==='Enter') sendMessage(); });
clearBtn.onclick = ()=> chat.innerHTML='';

/* TTS */
function speakText(text){ if(currentUtterance){ speechSynthesis.cancel(); } currentUtterance=new SpeechSynthesisUtterance(text); currentUtterance.lang='ru-RU'; speechSynthesis.speak(currentUtterance); }

ttsToggle.onclick = ()=>{ ttsEnabled = !ttsEnabled; ttsToggle.textContent = ttsEnabled ? '–í–∫–ª—é—á–µ–Ω–æ üîä' : '–û—Ç–∫–ª—é—á–µ–Ω–æ üîà'; };
stopSpeak.onclick = ()=> speechSynthesis.cancel();

/* Mic */
micToggle.onclick = ()=>{
  if(!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)){ alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥'); return; }
  if(!rec){ const SR = window.SpeechRecognition || window.webkitSpeechRecognition; rec = new SR(); rec.lang='ru-RU'; rec.interimResults=false; rec.onresult=e=>sendMessage(e.results[0][0].transcript); rec.onend=()=>{ if(micActive) rec.start(); } }
  if(!micActive){ micActive=true; micToggle.textContent='–í—ã–∫–ª—é—á–∏—Ç—å üé§'; rec.start(); } else { micActive=false; micToggle.textContent='–í–∫–ª üé§'; rec.stop(); }
}

/* Photo */
photoSend.onclick = ()=> photoFile.click();
photoFile.onchange = async function(){ const file=this.files[0]; if(!file) return; addMessage('üì∑ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ','user'); const reader=new FileReader(); reader.onload=async ()=>{ const base64=reader.result.split(',')[1]; const typing=createTypingBubble(); chat.appendChild(typing); try{ const res=await fetch('https://openai-proxy-3.onrender.com/v1/responses',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ model:'gpt-4o-mini', input:[{ type:'input_image', image_base64:base64, instruction:'–û–ø–∏—à–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ' }] }) }); const data=await res.json(); const t = document.getElementById('typingBubble'); if(t) t.remove(); const ans=data.output?.[0]?.content?.[0]?.text || '–û—à–∏–±–∫–∞: –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞'; addMessage(ans,'ai'); if(ttsEnabled) speakText(ans); }catch(e){ const t = document.getElementById('typingBubble'); if(t) t.remove(); addMessage('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞','ai'); } }; reader.readAsDataURL(file); };

</script>
</body>
</html>
